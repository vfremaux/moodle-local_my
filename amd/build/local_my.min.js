define(["jquery","core/config","core/log"],function(a,b,c){var d;return{init:function(b){a(".local-my-cat-collapse").bind("click",this.toggle_cat_state),a("#id-modalities-chooser").bind("change",this.toggle_modality),a(".local-my-area-ctls").bind("click",this.global_area_ctl),c.debug("AMD Local my cat control initialized"),d=b},toggle_cat_state:function(d){d.stopPropagation(),d.preventDefault();var e=a(this);return regex=/local-my-cathandle-([^-]+)-([0-9]+)/,matchs=regex.exec(e.attr("id")),matchs?(area=matchs[1],catid=parseInt(matchs[2]),c.debug("Working for cat "+catid+" in area "+area),url=b.wwwroot+"/local/my/ajax/stateregister.php?",url+="item="+area,url+="&catid="+catid,handlesrc=a("#local-my-cathandle-"+area+"-"+catid).attr("src"),a(".local-my-course-"+area+".cat-"+area+"-"+catid).first().hasClass("collapsed")?(a(".local-my-course-"+area+".cat-"+area+"-"+catid).removeClass("collapsed"),handlesrc=handlesrc.replace("collapsed","expanded"),a("#local-my-cathandle-"+area+"-"+catid).attr("src",handlesrc),hide=0):(a(".local-my-course-"+area+".cat-"+area+"-"+catid).addClass("collapsed"),handlesrc=handlesrc.replace("expanded","collapsed"),a("#local-my-cathandle-"+area+"-"+catid).attr("src",handlesrc),hide=1),url+="&hide="+hide,a.get(url,function(a){}),!1):void 0},toggle_modality:function(){that=a(this),modalityid=that.attr("id").replace("local-my-static-select-","local-my-static-modal-"),a(".local-my-statictext-modals").addClass("local-my-hide"),a("#"+modalityid).removeClass("local-my-hide")},global_area_ctl:function(c){if(that=a(this),c.stopPropagation(),c.preventDefault(),regexp=/local-my-cats-([^-]+)-([^-]+)$/,matches=that.attr("id").match(regexp),matches){var d=matches[1],e=matches[2];return"collapseall"==d?(a(".local-my-course-"+e).addClass("collapsed"),a(".local-my-cat-collapse-"+e).each(function(a,b){var c=b.src;c=c.replace("expanded","collapsed"),b.src=c}),url=b.wwwroot+"/local/my/ajax/stateregister.php?",url+="item="+e,url+="&catids="+a("#local-my-areacategories-"+e).html(),url+="&what=collapseall",a.get(url)):(a(".local-my-course-"+e).removeClass("collapsed"),a(".local-my-cat-collapse-"+e).each(function(a,b){var c=b.src;c=c.replace("collapsed","expanded"),b.src=c}),url=b.wwwroot+"/local/my/ajax/stateregister.php?",url+="item="+e,url+="&catids="+a("#local-my-areacategories-"+e).html(),url+="&what=expandall",a.get(url)),!1}}}});