define(["jquery","core/config","core/log"],function(a,b,c){var d={usereloadwaiter:!1,init:function(){a("#mydashboard .block").on("click",".local-my-cat-collapse",[],this.toggle_cat_state),a("#mydashboard .block").on("change",".local-my-modality-chooser",[],this.toggle_modality),a("#mydashboard .block").on("click",".local-my-area-ctls",[],this.global_area_ctl),a("#mydashboard .block").on("click",".detail-handle",[],this.toggle_detail),a("#mydashboard .block").on("click",".add-to-favorites-handle",[],this.add_to_favorites),a("#mydashboard .block").on("click",".remove-from-favorites-handle",[],this.remove_from_favorites),a("#mydashboard .block").on("click",".course-filter",[],this.refresh_course_list),a("#mydashboard .block").on("click",".course-sort",[],this.refresh_course_list),a("#mydashboard .block").on("click",".course-display",[],this.refresh_course_list),a("#mydashboard .block").on("click",".course-time",[],this.refresh_course_list),a("#mydashboard .block").on("click",".reload-areas",[],this.refresh_course_list),0!==a(".is-accordion").length&&(a(".is-accordion .local-my-course").hide(),a(".is-accordion .local-my-cat-collapse > h3 > a").attr("aria-expanded","false")),a(".reload-areas").each(function(){c.debug("Launching refresh on "+a(this).attr("data-widget")+"-"+a(this).attr("data-uid")),a(this).trigger("click")}),this.usereloadwaiter=!0,c.debug("AMD Local My initialized")},postreset:function(){0!==a(".is-accordion").length&&(a(".is-accordion .local-my-course").hide(),a(".is-accordion .local-my-cat-collapse > h3 > a").attr("aria-expanded","false"))},hide_home_nav:function(){a('a[data-key="home"]').css("display","none")},toggle_cat_state:function(d){d.stopPropagation(),d.preventDefault();var e=a(this),f=/local-my-cathandle-([^-]+)-([0-9]+)/,g=f.exec(e.attr("id"));if(g){var h=g[1],i=parseInt(g[2]);if(c.debug("Working for cat "+i+" in area "+h),0===e.closest(".is-accordion").length){var j=b.wwwroot+"/local/my/ajax/stateregister.php?";j+="item="+h,j+="&catid="+i;var k=0;a(".local-my-course-"+h+".cat-"+h+"-"+i).first().hasClass("collapsed")?(a(".local-my-course-"+h+".cat-"+h+"-"+i).removeClass("collapsed"),a("#local-my-cathandle-"+h+"-"+i+" > h3 > a").attr("aria-expanded","true"),c.debug("Expanding "+h+" in area "+i),k=0):(a(".local-my-course-"+h+".cat-"+h+"-"+i).addClass("collapsed"),a("#local-my-cathandle-"+h+"-"+i+" > h3 > a").attr("aria-expanded","false"),c.debug("Closing "+h+" in area "+i),k=1),j+="&hide="+k,a.get(j,function(){})}else a(".local-my-course-"+h).slideUp("normal"),a(".local-my-cat-collapse-"+h+" > h3 > a").attr("aria-expanded","false"),a(".local-my-course-"+h+".cat-"+h+"-"+i).slideDown("normal"),a("#local-my-cathandle-"+h+"-"+i+" > h3 > a").attr("aria-expanded","true");return!1}},toggle_modality:function(){var b=a(this),c=b.attr("id").replace("local-my-static-select-","local-my-static-modal-");a(".local-my-statictext-modals").addClass("local-my-hide"),a("#"+c+"-"+b.val()).removeClass("local-my-hide")},toggle_detail:function(b){b.stopPropagation(),b.preventDefault();var c=a(this),d=c.attr("id").replace("detail-handle-",""),e="#details-indicators-"+d;return"none"===a(e).css("display")?(a(e).css("display","flex"),c.attr("aria-expanded",!0),c.children("i").removeClass("fa-caret-down"),c.children("i").addClass("fa-caret-up")):(a(e).css("display","none"),c.attr("aria-expanded",!1),c.children("i").removeClass("fa-caret-up"),c.children("i").addClass("fa-caret-down")),!1},global_area_ctl:function(c){var d=a(this);c.stopPropagation(),c.preventDefault();var e=/local-my-cats-([^-]+)-([^-]+)$/,f=d.attr("id").match(e);if(f){var g=f[1],h=f[2],i="";return"collapseall"==g?(a(".local-my-course-"+h).addClass("collapsed"),a(".local-my-cat-collapse-"+h+" > h3 > button > img").each(function(a,b){var c=b.src;c=c.replace("expanded","collapsed"),b.src=c}),i=b.wwwroot+"/local/my/ajax/stateregister.php?",i+="item="+h,i+="&catids="+a("#local-my-areacategories-"+h).html(),i+="&what=collapseall",a.get(i)):(a(".local-my-course-"+h).removeClass("collapsed"),a(".local-my-cat-collapse-"+h+" > h3 > button > img").each(function(a,b){var c=b.src;c=c.replace("collapsed","expanded"),b.src=c}),i=b.wwwroot+"/local/my/ajax/stateregister.php?",i+="item="+h,i+="&catids="+a("#local-my-areacategories-"+h).html(),i+="&what=expandall",a.get(i)),!1}},sektor:function(a){"color"in a||(a.color="#bb3030"),"circlecolor"in a||(a.circlecolor="#ddd");new Sektor(a.id,{size:a.size,stroke:0,arc:!1,angle:a.angle,sectorColor:a.color,circleColor:a.circlecolor,fillCircle:!0})},add_to_favorites:function(){var d=a(this),e=d.attr("data-course"),f=d.hasClass("light"),g=b.wwwroot+"/local/my/ajax/service.php";g+="?what=addtofavorites",g+="&courseid="+e,d.removeClass("fa-star-o"),d.addClass("fa-star"),f&&(d.removeClass("add-to-favorites-handle"),d.addClass("remove-from-favorites-handle")),c.debug("Adding course "+e+" to favorites"),a.get(g);var h=a(".favorite-courses");h.length&&h.each(function(){a(this).children(".reload-areas").trigger("click")})},remove_from_favorites:function(){var d=a(this),e=d.attr("data-course"),f=d.hasClass("light"),g=b.wwwroot+"/local/my/ajax/service.php";g+="?what=removefromfavorites",g+="&courseid="+e,c.debug("Removing course "+e+" from favorites"),a.get(g),a('.icon-favorite[data-course="'+e+'"]').removeClass("fa-star"),a('.icon-favorite[data-course="'+e+'"]').addClass("fa-star-o"),f&&(d.removeClass("fa-star"),d.addClass("fa-star-o"),d.removeClass("remove-from-favorites-handle"),d.addClass("add-to-favorites-handle"));var h=a(".favorite-courses");h.length&&h.each(function(){a(this).children(".reload-areas").trigger("click")})},refresh_course_list:function(){var e=a(this),f=e.attr("data-uid"),g=e.attr("data-view"),h=e.attr("data-widget");c.debug("Activating sort/filter/display option on "+f);var i=a(".course-filters-"+f+".active"),j=b.wwwroot+"/local/my/ajax/service.php";if(j+="?what=getcourses",j+="&widget="+h,j+="&uid="+f,j+="&view="+g,e.attr("data-sort"))j+="&sort="+e.attr("data-sort");else{var k=a(".course-sort-"+f+".active");k&&(j+="&sort="+k.attr("data-sort"))}if(e.attr("data-display"))j+="&display="+e.attr("data-display");else{var l=a(".course-display-"+f+".active");l&&(j+="&display="+l.attr("data-display"))}if(e.attr("data-time"))j+="&schedule="+e.attr("data-time");else{var m=a(".course-time-"+f+".active");m&&(j+="&schedule="+l.attr("data-time"))}var n;if(e.attr("data-filter")&&(n=e.attr("data-filter"),j+="&"+e.attr("data-filter")+"="+e.attr("data-filter-value")),i.length)for(var o in i)o.attr("data-filter")!=n&&(j+="&"+o.attr("data-filter")+"="+o.attr("data-filter-value"));d.usereloadwaiter&&a("#content-"+f).html('<img src="'+b.wwwroot+'/pix/i/loading.gif">'),a.get(j,function(b){a("#area-courses-"+f).html(b)},"html")}};return d});